```{r include_data, include = FALSE}
# Base de datos final
dt <- readRDS(here::here("Datos", "Finales", "series_version_final.rds"))

# Serie iecon. Se usa en FUENTES y CRÍTICAS
iecon <- haven::read_dta(here::here("Datos", "Originales", "Gallito-2000-2009.dta"))
iecon$fecha <- as.Date(paste(iecon$aniog,iecon$mesg, iecon$diag, sep = "-"))
iecon_ts <- iecon %>% 
    dplyr::group_by(aniog, mesg) %>% 
    dplyr::summarise(puestos = sum(puestos, na.rm = TRUE),
                            avisos = dplyr::n())
iecon_ts$fecha <- as.Date(paste(iecon_ts$aniog, iecon_ts$mesg,"1", sep = "-"))
iecon_ano <- iecon %>% 
                dplyr::group_by(fecha = lubridate::make_date(aniog)) %>%                          dplyr::summarise(puestos = sum(puestos, na.rm = TRUE),
                                 avisos = n())

# Serie de CERES. Utilizada en FUENTES:Ceres
ceres <- readxl::read_xls(here::here("Datos", "Originales", "ICDL-1998-2014.xls"),
                          col_names = TRUE, sheet = "serie", 
                          col_types =c("date","numeric"),
                          readxl::cell_cols("A:B"))
ceres_ts <- ts(data = ceres[,2], start = c(1998,3), frequency = 12)
ceres_ano <- 
    ceres %>% 
        dplyr::group_by(fecha = lubridate::make_date(lubridate::year(fecha))) %>%
        dplyr::summarise(ind_vacantes = mean(vacantes, na.rm = TRUE))

```

# Datos {#Datos}
<!-- Acá se puede agregar que para definir dichas fuentes se utiliza la información de la encuesta sobre uso de internet -->
<!-- % Desempleo -->
@Barnichon2010 genera un índice de vacantes utilizando datos de encuestas, avisos en periodicos y portales web. @BankChile2002 utiliza datos de cinco zonas geográficas y sus principales periódicos, mientras @ArgentinaBC2019 utiliza datos recabados por el Ministerio de Trabajo.

El caso uruguayo presenta particularidades de hacer notar. Hasta la década del 2000 la única fuente relevante de avisos laborales en papel fue _Gallito_, por lo cual basta con recabar dicha información para tener una muestra representativa de los avisos laborales. Sin embargo, con la revolución de Internet y los portales web comienza a perder representatividad. A partir de allí el problema se divide en tres: 1) Cuánta representatividad pierde 2) A partir de año comienza a perderla 3) Para responder 1 y 2, es necesario definir que otras fuente relevantes aparecen y la población de avisos a utilizar, la cual debe ser representativa de todos los portales laborales.

Las nuevas fuentes laborales consideradas en Uruguay son _Buscojobs_ portal laboral que nace a partir del año 2007 y rápidamente logra obtener un cuota relevante del mercado^[Los datos de _Uruguay Concursa_ se obtienen indirectamente a partir de _Buscojobs_ debida a que dicho página los incluye entre sus publicaciones, por lo cual _Buscojobs_ debe interpretarse como la suma de ambos portales laborales.]. _Computrabajo_ empresa multinacional con sede en Escocia que comienza a operar en Uruguay a partir del año 2003 con un stock de avisos mínimo. Y _Uruguay Concursa_ portal laboral que centraliza todos los llamados de empleos públicos^[La página omitida más relevante es _LinkedIn_, sin embargo, su participación recién comienza en los últimos cuatro o cinco años y según la encuesta de uso de Internet no más del 15\% de personas consulta dicha página.].

La omnipresencia de _Gallito_ se mantiene hasta 2008-2009 cuando _Buscojobs_ comienza a tener un volumen relevante de avisos laborales al igual que _Computrabajo_. A partir de allí, su participación decrece de forma sistemática hasta estabilizarse en torno a un 40\% del total de publicaciones.

## Fuentes
<!-- Esto esta mal escrito -->
A continuación se mencionan todas las fuentes de datos utilizadas directa e indirectamente en la elaboración del índice, puesto que algunas solo fueron utilizadas para validar datos. Se detallan las utilizadas directamente en la construcción del indicador y se hace referencia a serie de avisos o de vacantes indistintamente, salvo que la diferencia deba ser mencionada.

En el Cuadro \ref{fuentes}, se presentan todas las fuentes de datos utilizadas en el trabajo. La primer columna refiere al tipo de información pudiendo ser avisos laborales, PEA, Encuesta Continua de Hogares (ECH), tasa de desempleo o encuesta de uso de Internet. La columna _Fuente_
establece cual es la institución que genero dichos datos sean portales laborales o el Instituto Nacional de Estadística (INE). _Extraída_ indica el lugar físico o virtual del cual fueron obtenidos los datos. Mientras _Periodo_ menciona los años contenidos en cada fuente de datos.

```{r fuentes, results='asis', fig.cap="Fuentes de datos"}
tabla <- data.table(Nombre = c(rep("Avisos laborales", 11), "PEA", "ECH", "Tasa desempleo", "Encuesta Internet"),
                    Fuente = c(rep("Gallito", 6), "Buscojobs", "Computrabajo", "Gallito", "Buscojobs", "Computrabajo", "INE", "INE", "INE", "CIFRA"),
                    Extraida = c("Urrestarazu", "Biblioteca Nacional", "Biblioteca Nacional", "CERES", "IECON", "Diario El País", "WaybackMachine", "WaybackMachine", "Portal Gallito", "Portal Buscojobs", "Portal Computrabajo", "Urrestarazu", "IECON", "INE", "CIFRA"),
                    Periodo = c("1980-1995", "1995-1998", "1999, 2000, 2009, 2010, 2011, 2012, 2013, 2014", "1998-2014", "2000-2009", "2013-2018", "2007-2018", "2003-2018", "2018-2019", "2019", "2018-2019", "1980-1995", "1980-2018", "1981-2019", "2015-2016"))

tabla[2:3, Nombre := paste0(Nombre, footnote_marker_number(1, "latex"))]
tabla[7:11, Nombre := paste0(Nombre, footnote_marker_number(1, "latex"))]

texto = "\\\\footnotesize Fuentes de avisos laborales utilizadas. En \\\\textit{Nombre} se define el tipo de información que contiene la fuente de datos. En \\\\textit{Fuente} se define la fuente de datos utilizada, es decir, donde se generó la información. En \\\\textit{Extraída} se menciona donde fueron recabados los datos física o virtualmente. \\\\textit{Periodo} refiere a los años a los cuales pertenecen las fuentes de datos."
kableExtra::kable(tabla, format = "latex", align = "c",
                  caption = "Fuentes de datos", 
                  booktabs = TRUE, escape = FALSE, 
                  row.names = FALSE, 
                  col.names = c("Nombre", "Fuente", "Extraída", "Periodo")) %>% 
  kableExtra::kable_styling(full_width = FALSE, font_size = 12) %>%
  # kableExtra::collapse_rows(valign = "top") %>%
  kableExtra::column_spec(column = 4, width = "3cm") %>%
  kableExtra::footnote(general = texto, 
                       number = "Datos de recolección propia. En todos los casos fue necesario imputar valores faltantes, lo cual se realizó mediante el paquete imputeTS.",
                       general_title = "Notas:",
                       threeparttable = TRUE,
                       escape = FALSE)
```

De *INE* se obtiene la tasa de desempleo para el departamento de Montevideo desde 1981 hasta 2019.
La ECH se utiliza desde 1980 hasta 2018, usándose una versión compatibilizada por parte del Instituto de Economía (IECON). Mientras las proyecciones poblacionales de Montevideo utilizadas son del periodo 1995-2025^[Dichas estimaciones vienen agrupadas por tramo etario en intervalos de cinco años, por lo tanto, no es posible obtener los mayores de 14 años, se debe trabajar con mayores de 15 años. Si bien esto podría introducir un leve sesgo, vale destacar que Urrestarazu para calcular la PEA omite mencionar que utiliza las proyecciones de población de CELADE, las cuales están agrupadas de la misma forma, ver @Celade1990.].

Para compatibilizar *Gallito*  primero se obtienen los datos de @Urrestarazu1997, quien utiliza la serie de vacantes construida por @Rama1988 en base a las publicaciones semanales de el diario El País, sección _Gallito_, Ministerio de Trabajo y Seguridad Social (MTSS) y Banco Central del Uruguay (BCU) con lo cual construye una serie trimestral entre 1978-1987\footnote{La serie construida por Rama une 3 fuentes que miden distintas poblaciones, las primeras dos son de carácter nacional mientras la tercera es departamental para Montevideo, el autor supone que no genera sesgos relevantes.}. Urrestarazu obtiene por parte de El País las publicaciones semanales entre 1989 y 1995, estima la cantidad de avisos entre 1988 y 1989 y calcula un índice de vacantes laborales de frecuencia trimestral desde 1978 hasta 1995, siguiendo la misma formula de Rama:\footnote{Para obtener la cantidad de avisos en 1987-1988 realiza un supuesto de aviso promedio. Estudian las publicaciones del primer trimestre de 1987 obtiene el tamaño del aviso promedio y supone que el mismo no varia para el total del periodo analizado. Posteriormente observando el espacio disponible con que contaba la sección de demanda de trabajo en cada edición estima la cantidad de avisos promedio que podían caber}.
<!-- % Los detalles de la unión de urrestarazu a un footnote -->
\begin{equation}
v_t = \frac{\frac{a_t}{a_0}}{\frac{PEA_t}{PEA_0}}
\end{equation}

Segundo, se recaba de forma exhaustiva los avisos laborales existentes en las publicaciones semanales de _Gallito_ entre octubre de 1995 y agosto de 1998. Además de los trimestres en los años 1999, 2000, 2009, 2010, 2012, 2013.

Tercero, se agrega una base de datos confidencial entregada por el diario El País entre 2013 y 2018 con un contenido exhaustivo de avisos laborales publicados en _Gallito_. Finalmente, se realiza scraping de la página web _Gallito_ entre 2018 y 2019 de forma mensual o bi-mensual.

Todos los datos de 2013-2019 referidos al gallito son publicaciones donde se han limpiado publicaciones repetidas por link\footnote{Esta limpieza refiere a publicaciones con link idéntico, lo cual es un identificador utilizado en la base de datos. Posteriormente se realiza una limpieza adicional utilizando la similaridad del texto de los avisos.}. Como se puede observar en la Figura \@ref(fig:ga13-18-comparacion) el efecto es cambio de nivel, pero manteniendo la misma curvatura de la serie de avisos sin filtrar.

<!-- Ver script analsisi_distintas_series.R, limpiarlo -->
Se utilizan los datos de @Ceres2012 ^[Centro de Estudios de la Realidad Económica y Social (*CERES*)], quien construye un índice de vacantes laborales llamado "Índice Ceres de Demanda Laboral" (ICDL) desde abril de 1998 hasta julio de 2014, de frecuencia mensual. Los datos conseguidos están corregidos por factores estacionales, pero no se detalla el filtro aplicado a la serie. Tampoco es especificada la fuente de la cual se obtienen.

Dada la falta de especificaciones, se contrasta con otras fuentes de datos. Para ello se utiliza la información generada por @Alma2011, base de datos facilitada por los autores. Con ella se construye un índice de frecuencia anual, el cual no puede ser comparado gráficamente con ICDL debido a que las escalas no son compatible. Se calcula la correlación lineal entre ambos índices la cual resulta 97\% y se analizan ambas series en tasas de crecimiento, mediante una transformación logarítmica y posterior diferencia. Ambas muestran resultados similares con una correlación lineal de 90\%. En este último caso las escalas son compatibles y el resultado puede observarse en la Figura \@ref(fig:iecon-ceres).

El último paso para validar el índice es recolectar muestras trimestrales de avisos entre 1999 y 2013 (denotados _muestreos_), de forma tal de corroborar la hipótesis que el ICDL debe estar generado a partir de publicaciones de _Gallito_^[El término _muestreos_ refiere a recolecciones realizadas en los trimestres de 1999, 2000, 2009, 2010, 2011, 2012, 2013 y 2014 los cuales pueden verse en la Figura \@ref(fig:series-conjuntas) con color gris]. En la Figura \@ref(fig:series-conjuntas) puede verse como los _muestreos_ siguen el índice hasta el año 2012, a partir de allí se genera una diferencia en torno a los 1500-2000 avisos. Se asume que a partir de dicho año o bien cambio la metodología o se sumaron nuevas fuentes de datos.
<!-- % Agregar imagen -->
<!-- % Agregar fórmula -->
<!-- % Agregar en el anexo los métodos de imputación utilizados. -->

En *Buscojobs* se recaba la cantidad de publicaciones mensuales publicadas por el portal _Buscojobs_ entre 2007 y 2019. Para el periodo 2007 a 2018 se obtienen muestras por mes y en cada mes, las cuales son promediadas mensualmente obteniendo la cantidad de avisos mensuales, dichos datos son obtenidos a través de la página web _Waybackmachine_. Para el año 2019 se realiza scraping del portal _Buscojobs_.

Finalmente, en *Computrabajo* se extraen todas las publicaciones mensuales disponibles publicadas en el portal laboral _Computrabajo_ entre 2003 y 2018 a partir de _Waybackmachine_ y avisos laborales entre 2018 y 2019 mediante scraping del portal _Computrabajo_. La particularidad de este portal es que la cantidad de avisos publicados que se observa no se corresponde con la cantidad de avisos publicados en los últimos 30 días debido a que dicho portal mantiene avisos por más de 60 días, inclusive. 

Es de hacer notar, que las tres páginas web de las cuales se extrajeron los datos difieren en cuanto a la estructura con la cual presentan los avisos laborales, pese a ser el mismo aviso se presenta de forma diferente y se pueden encontrar variaciones en cuanto a la información brindada. Por ejemplo, puede que el nombre del puesto y la empresa difieran levemente. En otras ocasiones no se brinda información respecto a la empresa, o se hace referencia a "importante empresa". Para poder identificar empresas compartidas por portales, primero se limpia el texto, se borran _stopwords_, se buscan patrones similares y finalmente se hace un filtro manual del cual se mapean 452 valores contenidos en una matriz de dimensión $\Re^{207*6}$ hacia un vector $x$ de dimensión $\Re^{207}$. 

En la Figura \@ref(fig:series-conjuntas) se puede observar las series trimestrales con las que se termina construyendo el índice de vacantes para el periodo 1980-2019. En todos los casos ha sido necesario imputar valores faltantes. El proceso se detalla en la sección siguiente.

```{r series-conjuntas, fig.cap = "Series trimestrales sin corregir"}
notas = "Series individuales de avisos laborales sin corregir. La serie color negro corresponde a Urrestarazu (1980-1995), elaboración propia (1995-1998, 1999Q1, 2000) y una predicción de dos años. La serie naranja son los avisos obtenidos a través del ICDL. El color verde refiere a los avisos de \\textit{Gallito}. Con color rojo y azul los avisos de \\textit{Buscojobs} y \\textit{Computrabajo}. La linea y puntos grises corresponden a avisos trimestrales de \\textit{Gallito} de recolección propia. Todas las series son de construcción propia."
fuentes = "Se utilizan datos de Urrestarazu (1980-1995) obtenidos de \\textit{Gallito}, de elaboración propia (1995-1998, 1999Q1, 2000, 2001Q1, 2009, 2010, 2011, 2012, 2013, recolectados de \\textit{Gallito}, de \\textit{Computrabajo}, \\textit{Buscojobs}, una base de datos de \\textit{Gallito} (2013-2018) y datos de scraping web de \\textit{Buscojobs}, \\textit{Computrabajo} y \\textit{Gallito}."

col_um           = "black"
col_ceres        = "darkorange"
col_ga           = "darkgreen"
col_ct           = "darkblue"
col_bj           = "red"
col_muestreos    = "gray"
colores <-  c(col_um, col_ceres, col_ga, col_ct, col_bj, col_muestreos)
long_dt <- melt.data.table(data = dt, id.vars = "fecha", 
                measure.vars = c("av_urr_mol", "av_ceres", "av_ga_s_dup", 
                                 "av_ct_s_dup", "av_bj_s_dup", "muestreos"),
                variable.name = "series", value.name = "avisos")
ggplot(long_dt, aes(x = fecha, y = avisos, color = series)) +
    geom_line(linetype = "dashed") +
    geom_point(data = long_dt[series == "muestreos",], aes(x = fecha, y = avisos)) +
    scale_color_manual(values = colores, 
                       labels = c("Urr-Molina", "Ceres", 
                                  "Gallito", 
                                  "Computrabajo", "Buscojobs", 
                                  "Muestreos"),
                       name = "") +
    scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) +
    scale_x_date(date_breaks = "5 year", date_labels = "%Y") +
    labs(x = "Fecha", y = "Avisos") +
    theme_Publication(position_legend = "bottom")
```

## Construcción

Inicialmente para despejar los avisos totales entre 1980 y 1995 se deben utilizar la *PEA* calculada por Urrestarazu, posteriormente se debe calcular dicha variable desde 1995 hasta 2019 y finalmente unir ambas estimaciones.

Se calcula la PET desde 1997 con frecuencia trimestral a partir de la ECH, se estiman los valores ausentes en 1996 y 1997, y se obtiene $pet_{96-18}$. La estimación es un promedio no ponderado de una interpolación mediante splines y un modelo básico estructural estimado mediante un filtro de Kalman suavizado [@Durbin2013;@Moritz2017].
Segundo, se trimestraliza la serie anual de población en edad de trabajar en Montevideo, usando el método de denthon-chollete [@Sax2013], con promedios, usando como serie guía la PET trimestral en el paso previo. Tercero la PEA, se obtiene usando la TA publicada por el INE, por definición $TA = PEA/PET$.
Cuarto se repondera la PEA de 1981-1995 y se unen las series. Finalmente se estiman los valores de 1980-1981 mediante un promedio simple de una estimación mediante un modelo estructural básico estimado por filtro de Kalman suavizado y un modelo Arima en representación de espacio estado.

<!-- ### 1980 -->
El objetivo es obtener una aproximación de la cantidad de avisos totales, por ello primero es necesario obtener $a_t$ desde el índice de vacantes Urrestarazu. Sin embargo, la base de dicho índice es 1980 y los datos disponibles en el trabajo son desde 1981 en adelante. El índice esta expresado en función de la PEA:
\begin{equation}
v_t = \frac{\frac{a_t}{a_0}}{\frac{PEA_t}{PEA_0}}
\end{equation}

No se conoce $a_0$ ni $PEA_0$, ni se tienen datos de 1980. Por lo cual, se siguen los siguientes pasos:

1. Obtener $a_t$ en algún punto: $a_{1995_q4}$\footnote{La cantidad de avisos laborales del cuarto trimestre de 1995, fueron obtenidos a partir de las publicaciones del diario El País, sección Gallito}.
2. Imputar la PEA hacia atrás, obteniendo $pea_{t=0}$.
3. Despejar $a_{t=0}$ de 
$v_t$ = $(a_t/pea_t)/(a_{t=0}/pea_{t=0})100$.
4. Obtener la base $\alpha$ = $a_{t=0}$/$pea_{t=0}$.
5. Imputar las vacantes hacía atrás.
6. Calcular la serie de avisos

Se opta por realizar una predicción hacia atrás, planteando un modelo básico estructural mediante un filtro de Kalman suavizado [@Durbin2013]^[Se plantearon formulaciones alternativas, como imputación mediante filtro de Kalman sin suavizar, con 3 tipos de modelos estructurales: nivel-local, tendencia y básico estructural [@Harvey1989], además de modelos Arima.]. A partir de de ahora se trabaja con una serie trimestral de avisos.

<!-- ### 95-98 -->
A continuación se elige unir la serie de avisos $a_t^{80-95}$ con los avisos recolectados entre 1995 y 1998, dado que se utilizo $a_{1995}^{q4}$ para poder despejar la cantidad de avisos $a_t^{80-95}$ las series coinciden por construcción en el cuarto trimestre de 1995, por lo cual pueden ser combinadas sin realizar ningún calculo adicional, la serie obtenida se denota $a_{um}^{80-98}$. Como se puede observar en la Figura \@ref(fig:series-conjuntas) las series combinadas mantienen el mismo nivel, aunque llama la atención la caída observada que se da entre 1995 y 1996. Sin embargo, dicha disminución no es causada por la combinación de las series, la misma comienza en el índice de vacantes de Urrestarazu donde los últimos cuatro trimestres tienen respectivamente una caída interanual de -17.3\%, -29.4\%, -25\% y -18.4\%. Estás caídas coinciden con la crisis del tequila y partir de 1996 se comienza a revertir y se inicia un período de crecimiento que se mantiene por al menos 3 años.

<!-- ### 98-14 -->

Luego, se utiliza el Índice CERES de Demanda Laboral (ICDL), $a_{ceres}^{98-14}$, de frecuencia mensual y sin factores estacionales\footnote{Como se mencionó, no se conoce el método de desestacionalización, solo se sabe que las notas metodológicas indican que esta ajustado por factores estacionales, sin embargo, por los análisis realizados lo más verosímil es que la serie publicada sea la tendencia-ciclo o incluya un promedio móvil, en la sección siguiente se responden dichas críticas}. El índice tiene la forma $v_t = a_t/a_0$, el problema es que observamos $\tilde{v_t}$ debido a la desestacionalización y no conocemos $a_0$. Aún conociendo $a_0$, no es posible recobrar el verdadero $a_t$, pero es posible encontrar una aproximación que mantenga el mismo movimiento y tendencia.

La serie es trimestralizada y se analiza si es necesario realizar alguna corrección. Recordemos en la sección previa se realizaron distintas pruebas para validar la hipótesis que el ICDL corresponde, al menos hasta 2012, con publicaciones de _Gallito_. Es decir, estamos suponiendo que el proceso generador de datos es el mismo. La diferencia radica en que ha dicha serie le ha sido quitado, al menos, el componente estacional. 

Si suponemos que nuestro proceso generador de datos es^[Basandonos en @Harvey1989]:
\begin{equation}
Y_t = S_t + T_t + C_t + I_t
\end{equation}
Y observamos que $a_t^{ceres}$ es $T_t + C_t$ el hecho de que ajustemos el nivel de la serie mediante una corrección, por ejemplo, una reponderación, quiere decir que estaríamos reponderando la tendencia-ciclo de la serie. Si se observa la Figura \@ref(fig:series-conjuntas), tanto los muestreos como la serie $a_{um}^{80-98}$^[Notar que la serie se extiende hasta el año 2001. Esto se debe a que se realizaron predicciones de tal forma de tener más observaciones y observar el comovimiento de las series. Sin embargo, dicho período es difícil de predecir, ya que, coincide con la devaluación brasileña y posterior comienzo de recesión en la economía uruguaya, finalizando en una de las peores crisis económicas de su historia. La predicción puede ser mejorada, pero no es el objetivo, sino simplemente ver si existe una diferencia insalvable en el nivel de las series, en la medida que esto no se observa, se deja de lado seguir probando proyecciones] acompañan el nivel de $a_t^{ceres}$, a tal punto que en algunos trimestres prácticamente coinciden. Suponemos que dichas diferencias se asocian a que es una serie filtrada, por lo cual se opta por unir las series a partir de 1998-III sin realizar ninguna corrección^[Adicionalmente, se genero una serie de estacionalidad entre 1995 y 2018 utilizando los avisos recolectados entre 1995-1998 y los datos entregados por El País. Se imputo la estacionalidad para el periodo 1998-2013 y se agrego dicho componente a los avisos de _Ceres_, los resultados no varían.].
Se trimestraliza, y se realiza la unión, ambas series coinciden en el período compartido, se obtiene $a_{umc}^{80-14}$.

<!-- ### 13-19 Ga -->
El paso siguiente es la creación de una serie mensual de publicaciones sin avisos repetidos por link, utilizando los datos proporcionados por el diario El País, entre 2013 y 2018. Dicha serie se une con los avisos obtenidos para el año 2019 mediante el scraping web de la página web _Gallito_^[La información de los últimos tres meses de 2018 se obtuvo desde @MTSS2018]. Posteriormente se trimestralizan los datos.

```{r comparacion-gallito, fig.cap="comparacion-gallito"}
comparacion_gallito <- data.table(
    avisos_bd_s_dup = dt[data.table::between(fecha, "2013-10-01", "2014-10-01"), av_ga_s_dup],
    avisos_bd_c_dup = dt[data.table::between(fecha, "2013-10-01", "2014-10-01"), av_ga_c_dup],
    avisos_papel    = dt[data.table::between(fecha, "2013-10-01", "2014-10-01"), muestreos],
    fecha = seq.Date(as.Date("2013-10-01"), as.Date("2014-10-01"), "quarter")
)
comparacion_gallito[, `:=`(ratio_s_dup = avisos_papel/avisos_bd_s_dup,
                           ratio_c_dup = avisos_papel/avisos_bd_c_dup,
                           diferencia_s_dup = as.integer(avisos_papel - avisos_bd_s_dup)#,
                           # pct_s_dup = avisos_bd_s_dup/avisos_papel,
                           # pct_c_dup = avisos_bd_c_dup/avisos_papel
                           )]
data.table::setnames(comparacion_gallito, old = names(comparacion_gallito), new = c("avisos s/dup", "avisos c/dup", "avisos papel", "fecha", "ratio s/dup", "ratio c/dup", "diferencia s/dup"))
setkey(comparacion_gallito, "fecha")
notas <- "La primera columna son los avisos web (base de datos) de El País una vez filtrados los avisos duplicados (link-ID repetido), la segunda considera los duplicados. La tercera columna avisos papel, refiere a los avisos recolectados en papel de Gallito, mientras fecha hace referencia al periodo correspondiente. Las columnas ratio s/dup y ratio c/dup indican ratio con duplicados y sin duplicados y corresponden a la división de la tercera columna con la primera o segunda respectivamente. La última columna, refiere a lo mismo pero tomando diferencias entre primera y segunda columna sobre tercera."
fuentes <- "Datos de Gallito tanto en versión papel de recolección propia como datos web facilitados por diario El País, elaboración propia."

kableExtra::kable(comparacion_gallito, format = "latex", align = "c", booktabs = T, digits = 2, caption = "Comparación avisos laborales") %>%
kableExtra::kable_styling(latex_options = "scale_down", position = "center") %>%
  kableExtra::footnote(general = fuentes, number = notas,
                       number_title = "Notas:", general_title = "Fuentes:", footnote_as_chunk = F, threeparttable = TRUE, footnote_order = c("number", "general"))
```

Se utilizan los avisos laborales facilitados por el diario El País para el período 2013-2018, con ellos se construye una serie trimestral de la cantidad de publicaciones.
Dichos datos es la variable no observable que deseamos cuantificar en los períodos previos pero que observamos con errores de medición, por ello lo denotamos $\tilde{a_t}$. Para obtener cuanto difieren los avisos en papel de los avisos de la base de datos, se muestrean los siguientes trimestres: $a_{q4}^{13}$, $a_{q1}^{14}$, $a_{q2}^{14}$, $a_{q3}^{14}$, $a_{q4}^{14}$\footnote{En todos los casos existen semanas, donde la publicación semanal no estaba disponible. Por ello, se modelizaron serie de frecuencia semanal las cuales fueron imputadas mediante la modelización de un modelo básico estructural estimado por un filtro de Kalman suavizado}. Como se puede observar en el Cuadro \ref{comparacion-gallito} la diferencia entre $\tilde{a_t}$ y ${a_t}$ es significativa. 

Se elige corregir la serie $a_{umc}^{80-14}$ de forma de que la serie queda expresada en los mismos términos que los avisos actuales, $\tilde{a_t}$, por lo cual, es posible seguir extendiendo el periodo de análisis simplemente agregando futuras observaciones obtenidas mediante scraping. Se repondera la serie $a_{umc}^{80-14}$ en base al promedio de los avisos $a_{q2}^{14}$, $a_{q3}^{14}$, $\tilde{a}_{q2}^{14}$, $\tilde{a}_{q3}^{14}$, obteniendo $\tilde{a}_{umc}^{80-14}$.

Se utilizan los _muestreos_ para corroborar que la fuente del ICDL sea _Gallito_.
Dada la diferencia que se observa entre los _muestreos_ y $a_{ceres}^{98-14}$ a partir del año 2012, se considera dicha serie hasta el primer trimestre de 2012. Esta decisión se fundamenta, como se mencionó en la sección anterior, en que el ICDL coincide con los _muestreos_ realizados cuya diferencia puede ser atribuida a la desestacionalización del mismo, sin embargo, en 2013 y 2014 las diferencias son de un orden de magnitud tal que dicha hipótesis no puede ser mantenida. 
Como forma de acercarse a esto, en base a las series disponibles se genera una serie de estacionalidad imputada desde 1995 hasta 2018 de frecuencia mensual plateando los siguientes modelos:

$$
\begin{aligned}
Y_t &= T_t + C_t + S_t + I_t \\
Y_t &= T_t C_t S_t I_t
\end{aligned}
$$
Se recupera el componente $S_t$ y $S_t + I_t$, se generan dos series, las cuales son imputadas entre 2001 y 2012. En ningún caso los valores absolutos de la estacionalidad superan los 600 avisos, si eso se trimestraliza la diferencia máxima que se observa es inferior a 1000 avisos.

Finalmente, se unen las series imputando los valores trimestrales $a_{q2}^{12}$, $a_{q3}^{12}$, $a_{q4}^{12}$, $a_{q2}^{13}$. Se divide la serie en estaciones (trimestres) y se realizan imputaciones en cada serie por separado, utilizando el filtro de Kalman suavizado. De esta forma se obtiene la serie final correspondiente a _Gallito_ denotada como $a_{umcg}$, la misma se puede observar en la Figura \@ref(fig:serie-final-gallito) con color azul (umcg).

```{r serie-final-gallito, fig.cap = "Serie de avisos final"}
notas = "Serie trimestral de avisos laborales. Con color azul la serie final de Gallito, con color naranja serie de Gallito entre 2013 y 2018, color rojo serie avisos obtenidos mediante el ICDL y con color verde la serie combinada de Urrestarazu y Molina (construcción propia)."
fuentes = "1980-1995 datos extraídos de Urrestarazu, entre 1995 y 1998 recolección propia, 1998-2012 se utilizan los datos del ICDL, entre 2013 y 2018 datos provistos por diario El País, año 2019 obtenido mediante scraping web, construcción propia"
# Generar otra serie urr_mol pero sin la predicción, agregarla acá.
long_dt <- melt.data.table(data = dt, id.vars = "fecha", 
                measure.vars = c("av_umcg", "av_ga_s_dup", 
                                 "av_urr_mol", "av_ceres"),
                variable.name = "series", value.name = "avisos")
ggplot(long_dt, aes(x = fecha, y = avisos, color = series)) +
    geom_line(linetype = "dashed") +
    scale_color_manual(values = c("darkblue", col_ga, col_um, col_ceres),
                       labels = c("umcg", "Gallito", "Urr-Molina", "Ceres"),
                       name = "") +
    scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) +
    scale_x_date(date_breaks = "5 year", date_labels = "%Y") +
    labs(y = "Avisos", x = "Fecha") +
    theme_Publication(position_legend = "bottom")
```

Los publicaciones laborales del portal *Buscojobs* se recaban desde 2007/06 hasta 2018/12 a través de la página web _Waybackmachine_. Se contabilizaron todas las publicaciones mensuales encontradas que hacen referencia al total de avisos publicados, los cuales son promediados mensualmente. Es decir, cada punto refiere a un año-mes y el total de avisos de publicados en dicho momento.

En el año 2019, se realiza scraping sobre el portal _Buscojobs_, del cual se extraen todos los avisos laborales disponibles, la extracción de datos se realiza de forma mensual o bimensual y se obtiene la información completa de cada aviso.
La serie se modela con frecuencia mensual y los valores faltantes son imputados removiendo el componente estacional de la serie, imputando la serie desestacionalizada y luego agregando el componente estacional, finalmente la serie es trimestralizada, la misma puede obvervarse en la Figura \@ref(fig:serie-buscojobs).

```{r serie-buscojobs, fig.cap="Serie trimestral \\textit{Buscojobs}"}
notas = "Serie trimestral de avisos laborales publicados en el portal \\textit{Buscojobs}, construcción y elaboración propia"
fuentes = "Los datos fueron obtenidos a través del portal \\textit{Waybackmachine}, scraping de \\textit{Buscojobs} y finalmente imputando los valores faltantes."
bj_ct <- readRDS(here::here("Datos", "Finales", "serie_trim_bj_ct.rds"))
bj_ct[fecha >= "2007-04-01", 
      ggplot(.SD, aes(x = fecha, y = av_bj_s_dup)) +
        geom_line() +
        geom_point() +
        scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) +
        scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
        labs(y = "Avisos laborales", x = "Fecha") +
        theme_Publication(position_legend = "bottom")
]
```

Las publicaciones laborales del portal *Computrabajo* referido al total de avisos publicados, se promedia en los meses en que existen múltiples observaciones y se obtiene una serie de frecuencia mensual. A ella se agregan los datos de scraping desde octubre de 2018 hasta diciembre de 2019. Dado que _Computrabajo_, muestra una cantidad de avisos totales que difiere de la cantidad de avisos publicados en los últimos 30 días es necesario realizar una corrección, en caso contrario se estará sobrestimando los avisos publicados. De los datos obtenidos, se observa que los avisos publicados en los últimos 30 días representan un 40-43\% del número de avisos totales publicados que muestra el portal. A partir de julio de 2011, los avisos de _Computrabajo_ son reponderados por 0.42 y en las fechas previas por 0.63^[Esta decisión ad-hoc se toma puesto que a partir de julio de 2011 la serie de _Computrabajo_ comienza a tener un crecimiento exponencial, además en las fechas previas las cantidades de avisos son bajas comparativamente, por lo cual es menos probable que difieran la cantidad de avisos mostrados de los efectivamente publicados en los últimos 30 días.]. La serie final se observa en \@ref(fig:serie-computrabajo).

Finalmente, las tres series son combinadas. Para ello, se realiza un análisis del texto de los avisos laborales de forma de obtener el porcentaje de avisos compartidos entre páginas. Se construye un document-term matrix (DTM) con los avisos laborales, se vectorizan el texto mapeando palabras (1-gram) hacia un espacio vectorial, para esto es necesario crear un vocabulario común. Posteriormente, se calcula la similaridad de coseno:

$$
similaridad(doc1, doc2) = \cos(\theta) = \frac{doc1doc2}{|doc1||doc2|}
$$
entre los 3 portales web, obteniendo que los portales que más comparten avisos son _Computrabajo_ y _Buscojobs_, en torno a un 9\%, mientras con "El gallito" es torno a 3\%. Se combinan primero los avisos entre _Computrabajo_ y _Buscojobs_ ajustados por el \% de avisos compartidos, luego se combina con _Gallito_ en base al \% compartido.
<!-- % dic2018, 1485/3,755 -->

```{r serie-computrabajo, fig.cap= "Serie trimestral \\textit{Computrabajo}"}
notas = "Serie trimestral de avisos laborales publicados en el portal \\textit{Computrabajo}, construcción y elaboración propia."
fuentes = "Los datos fueron obtenidos a través del portal \\textit{Waybackmachine}, scraping de \\textit{Computrabajo} y finalmente imputando los valores faltantes."
bj_ct[, 
      ggplot(.SD, aes(x = fecha, y = av_ct_s_dup)) +
        geom_line() +
        geom_point() +
        scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) +
        scale_x_date(date_breaks = "1 year", date_labels = "%y") +
        labs(y = "Avisos laborales", x = "Fecha") +
        theme_Publication()
]
```

## Críticas

La serie construida esta sujeta a críticas, a continuación examinamos algunas de ellas.
<!-- %%%%%%%%%%% Respuesta a posibles críticas -->
<!-- % 1. Serie es de avisos y no de puestos, usar la serie de avisos y puestos en 1996 y 1997 para mostrar que las series siguen el mismo patrón.  -->
<!-- % 2. No se conoce serie CERES original, Test realizados sobre la serie de ceres -->
<!-- % 3. Serie contiene datos que no son de Montevideo -->
<!-- % 4. Serie esta sesgada hacia puestos de baja calificación? -->
<!-- % 5. Por qué no usar las tendencia-ciclo de cada serie y luego unir? -->
<!-- % 6. Duplicados? Reponderaciones? gallito -->
<!-- % 7. Duplicados, entre las != series gallit-ct-bj? Text Mining. -->

1. La serie es de avisos no de puestos laborales. En la medida que los puestos sigan una dinámica diferente que los avisos estaríamos representando de incorrectamente la demanda laboral por parte de las empresas. Para corroborar este punto, se llevan a cabo dos pruebas:  a) entre 1996 y 1998, se contabilizan todos los puestos publicados en la sección de avisos destacados\footnote{No se contabilizan los avisos publicados en otras secciones por un tema de tiempo. Por lo cual, se asume que los avisos en dichas secciones corresponden a un puesto}. En la Figura \@ref(fig:molina96-98) se observa que puestos y avisos se mueven de forma conjunta, manteniendo una diferencia de nivel.

```{r molina96-98, fig.cap="Avisos y puestos laborales \\textit{Gallito} 1996-1998", fig.align="center"}
notas = "Publicaciones Gallito, series de avisos y puestos laborales de frecuencia mensual, construcción propia. Se observa una diferencia de nivel entre las series de puestos y avisos laborales, ambas siguen el mismo movimiento. La serie de puestos se construyo contabilizando todos los puestos solicitados en la sección de avisos destacados, en el resto de las secciones todos los avisos se contabilizaron con un puesto."
fuentes = "Datos obtenidos de los avisos clasificados semanales de \\textit{Gallito}, recolección propia."
# Este código gráfica los avisos totales y los puestos totales en el periodo.
# LOs puestos totales no son tal, sino que a los avisos totales se suman los puestos de los avisos destacados.
molina <- readxl::read_xlsx(here::here("Datos", "Originales", "Gallito-1996-1998.xlsx"), col_names = TRUE, sheet = "avisos_puestos", na = c(" ", ""))
setDT(molina)
molina$puestos_tot <- ifelse(molina$subseccion != "avisos destacados", molina$avisos, molina$total_puestos)
molina[data.table::year(f_ini) > 1995, 
       .(av = sum(avisos, na.rm = T),
         av_filtro = sum(puestos_tot, na.rm = TRUE),
         fecha = as.Date(paste(ano, mes, 1, sep = "-"))), 
       keyby = .(ano = data.table::year(f_fin), mes = data.table::month(f_fin))
       ][, ggplot(.SD) +
             geom_line(aes(x = fecha, y = av)) +
             geom_line(aes(x = fecha, y = av_filtro), linetype = "dashed") +
             geom_point(aes(x = fecha, y = av)) +
             geom_point(aes(x = fecha, y = av_filtro)) +
             scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) +
             scale_x_date(date_breaks = "3 month", date_labels = "%y %b") +
             labs(y = "Avisos laborales", x = "Fecha") +
             theme_Publication(position_legend = "bottom")
         ]
```
<!-- Se podría agregar una pizca de análisis funcional, analizando la velocidad y aceleración -->

b) Entre los años 2000 y 2009, se cuenta con la base de datos proporcionada por IECON. Dicha base surge del trabajo de @Alma2011 en el cual contabilizan todos los avisos y puestos laborales en las primeras 2 semanas de los meses 3, 5 o 6 y 9 de los respectivos años. En la Figura \@ref(fig:iecon-avisos-puestos) se puede ver que ambas tienen una diferencia de nivel.

(ref:caption) @Alma2011

```{r iecon-avisos-puestos, fig.cap="Serie \\textit{Gallito} 2000-2009", fig.align="center"}

notas = "Serie de puestos y avisos laborales con frecuencia anual. Serie anual construida en base a los datos de las primeras dos semanas de los meses de marzo, junio y septiembre durante el periodo 2000-2009, construcción propia. Se observa un comovimiento entre avisos y puestos, donde la diferencia es de nivel."
fuentes = "Datos de (ref:caption), suministrado por autores."
ggplot(data = iecon_ts, aes(x = fecha, y = avisos)) +
    geom_line() +
    geom_point() +
    geom_line(aes(y = puestos), linetype = "dashed") +
    geom_point(aes(y = puestos)) +
    scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) +
    scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
    labs(y = "Cantidad de puestos", x = "Fecha") +
    theme_Publication()
```

2. Para el periodo 1998-2014 se usan datos del ICDL, al cual se la extrajeron los componentes estacionales no existiendo la serie original y no se tiene detalle de su metodología. Como se mostró en las secciones previas, se pudo corroborar que el ICDL corresponde, al menos hasta 2012, con los avisos laborales en papel recogidos en el diario El País, sección "Gallito". El ICDL tiene base agosto 1998, dicho mes fue contabilizado completamente lo cual permite generar una aproximación a la cantidad de puestos. A futuro es posible ampliar las muestras entre 1998 y 2014, combinar dichos datos con los obtenidos por @Alma2011, generar una subserie para el periodo 1998-2014, comparar con el ICDL y potencialmente dejar de utilizarlo. Esto permitiría recobrar el componente estacional, pero para este trabajo dicho componente no es relevante y tampoco lo es en la medida que la CB se suele analizar de forma desestacionalizada. Si lo es para tener una medida más precisa de las publicaciones laborales por si sola y lograr una mejor desestacionalización para la serie completa entre 1980 y 2019.

3. La serie de avisos es de Montevideo pero contiene información de otros departamentos. Observando la Figura \@ref(fig:avisos-dpto) que corresponde a todos los avisos obtenidos mediante scraping en el año 2019, se puede ver que para Buscojobs, Computrabajo y Gallito las publicaciones correspondientes a Montevideo son de 82\%, 84\% y 95% respectivamente. Por lo tanto, se puede mantener que es representativa de la capital. Es posible suponer que el porcentaje de publicaciones no de Montevideo se mantiene estable a lo largo del periodo y reponderar la serie de avisos. Sin embargo, se opta por trabajar con todos los datos.

4. La serie de _Gallito_ presenta un sesgo hacia puesto de baja calificación. En la Figura \@ref(fig:ga13-18-comparacion) se observa que la mayor cantidad de avisos corresponden a puestos de auxiliar, técnico/especialista, ejecutivo comercial y peón. Si bien, esto no es una muestra del sesgo, puesto que los puestos de mayor jerarquía son por definición menor a los puestos de menor calificación, por lo cual una simple comparación porcentual no nos dice nada. @Alma2011 utilizando la información de puestos laborales para el periodo 2000-2009, utilizando la misma fuente de datos realizan un análisis pormenorizado de la información publicada en cada aviso laboral y lo comparan con la ECH, concluyendo que _Gallito_ tiene sesgo hacia puestos de baja calificación. Es posible extender el análisis de @Alma2011 y replicarlo para el periodo 2013-2018. Lo mismo puede realizarse para el año 2019 con la información recolectada en _Buscojobs_ y _Computrabajo_.

5. La existencia de informalidad es una característica propia de los países subdesarrollados a la cual Uruguay y en específico Montevideo no escapa. Ello se agrava para los años entre 1980 y 2005, debido a las graves crisis económicas de 1982 y 2001-2002. Claramente las vacantes laborales publicadas en la prensa no captan los puestos generados en la informalidad. Una posible solución sería estimar la informalidad para el periodo considerado y ajustar una nueva serie de vacantes que tome en cuenta dicho factor. 

6. Representatividad de un índice de vacantes laborales. Se puede argumentar que tomar las vacantes laborales no es representativo de la demanda laboral. Sin embargo, @Barnichon2010 construye un índice de vacantes utilizando tanto fuentes de avisos laborales en la prensa, como encuestas a empresas realizadas por el Bureu of Labor Statistics mediante el Job Openings and Labor Turnover Survey (JOLTS). Observa que las series siguen la misma dinámica, aunque la serie de JOLTS necesita ser reescalada.

7. La serie de vacantes si bien tiene una correlación positiva con el PIB para el periodo 1980-2019, se correlaciona negativamente si se toma desde 2013 en adelante. Esto genera dudas importantes sobre su construcción en los últimos cinco años. Sin embargo, aún si se sumaran de forma bruta todos los avisos recolectados de _Gallito_, _Computrabajo_ y _Buscojobs_ la correlación negativa se mantiene. Vale recordar que _Buscojobs_ también contiene la información publicada en el portal _Uruguay Concursa_, por lo cual son cuatro fuentes de datos realmente relevantes. Esto puede verificarse en base a las encuestas del uso de Internet realizadas por Cifra, en base a los datos recolectados las páginas más utilizadas por las personas que buscan trabajo son las utilizadas en este trabajo, a excepción de _LinkedIn_. Es inverosímil pensar que agregando _LinkedIn_ cambie de forma tan relevante la dinámica de los avisos, en especial porque dicho portal levanta publicaciones de los cuatro portales utilizados en este trabajo. Una potencial explicación es que el PIB mantiene su base 2005, lo cual genera que el sector Telecomunicaciones tenga un crecimiento exponencial al ser valuado a precios de 2005. Al modificar la base es esperable que esto tenga un efecto importante y altere las estimaciones actuales del producto. Otra posible explicación es que la economía este pasando por un cambio muy importante en el cual la economía crece pero las firmas demandan cada vez menos puestos laborales, en la medida que sustituyen trabajo por capital y trabajo por nuevos procesos de producción. Si se añade que la serie principal de este trabajo, _Gallito_, tiene sesgo hacia puestos de baja calificación [@Alma2011] y estos son los más afectados por los nuevos procesos de producción y prestación de servicios, el efecto de crecimiento con menos solicitudes laborales se potencia.

<!-- Agregar el tema de los shares, porque usar las 3 series y no solamente 1 y ajustar los share? Creo que es la crítica más relevante a la serie -->

<!-- (CITAR ALGÚN TRABAJO SOBRE INFORMALIDAD EN URUGUAY) -->

<!-- % 5. Por qué no usar las tendencia-ciclo de cada serie y luego unir? -->
<!-- % 6. Duplicados? Reponderaciones? gallito -->
<!-- % 7. Duplicados, entre las != series gallit-ct-bj? Text Mining. -->

